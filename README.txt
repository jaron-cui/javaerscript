todo:
reorganize error-throwing functions so that errors are thrown before side effects are executed.